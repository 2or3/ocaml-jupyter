OASISFormat:            0.4
Name:                   ocaml-jupyter
Version:                0.2.0
Synopsis:               An OCaml kernel for Jupyter notebooks
Authors:                Akinori ABE
License:                MIT
Plugins:                META (0.4), DevFiles (0.4)
OCamlVersion:           >= 4.02
BuildTools:             ocamlbuild,cppo
AlphaFeatures:          ocamlbuild_more_args
XOCamlbuildPluginTags:  package(cppo_ocamlbuild)
FilesAB:                lib/core/JupyterVersion.ml.ab

Flag "install-kernel"
  Default:              true
  Description:          Add ocaml-jupyter kernel to Jupyter

Flag "archimedes"
  Default:              false
  Description:          Install jupyter.archimedes sub-package

PostConfCommand:        ./kernelspec.sh create $(bindir) > src/kernel.json
PostDistcleanCommand:   rm src/kernel.json
PostInstallCommand:     ./kernelspec.sh install $(install_kernel) $datadir/$pkg_name
PreUninstallCommand:    ./kernelspec.sh uninstall

Library jupyter
  Path:                 lib/core
  FindlibName:          jupyter
  BuildDepends:         uuidm, ppx_deriving_yojson
  XMETARequires:        uuidm, ppx_deriving_yojson.runtime
  Modules:              Jupyter,
                        JupyterMessage,
                        JupyterKernelMessage,
                        JupyterShellMessage,
                        JupyterIopubMessage,
                        JupyterStdinMessage,
                        JupyterCommMessage,
                        JupyterJson,
                        JupyterVersion

Library "jupyter-repl"
  Path:                 lib/repl
  FindlibName:          repl
  FindlibParent:        jupyter
  BuildDepends:         jupyter, compiler-libs.common, compiler-libs.toplevel, lwt, lwt.unix, lwt.ppx
  XMETARequires:        jupyter, compiler-libs.common, compiler-libs.toplevel, lwt, lwt.unix
  Modules:              JupyterRepl,
                        JupyterReplProcess,
                        JupyterReplToploop,
                        JupyterReplError
  Install:              false
  CompiledObject:       byte

Library "jupyter-kernel"
  Path:                 lib/kernel
  FindlibName:          kernel
  FindlibParent:        jupyter
  BuildDepends:         jupyter, jupyter.repl, lwt, lwt.unix, yojson, lwt-zmq, cryptokit,
                        lwt.ppx, ppx_deriving_yojson
  XMETARequires:        jupyter, jupyter.repl, lwt, lwt.unix, yojson, lwt-zmq, cryptokit,
                        lwt.ppx, ppx_deriving_yojson.runtime
  Modules:              JupyterKernelServer,
                        JupyterKernelConnectionInfo,
                        JupyterKernelMessageChannel,
                        JupyterKernelZmqChannel,
                        JupyterKernelChannelIntf,
                        JupyterKernelMerlin,
                        JupyterKernelHmac,
                        JupyterKernelLog
  Install:              false

Executable "ocaml-jupyter-kernel"
  Path:                 src
  MainIs:               JupyterMain.ml
  BuildDepends:         jupyter.kernel
  CompiledObject:       byte
  DataFiles:            ../setup.ml,
                        ../setup.log,
                        ../setup.data,
                        ../kernelspec.sh,
                        kernel.json

##
## Sub-packages
##

Library "jupyter-notebook"
  Path:                 lib/notebook
  FindlibName:          notebook
  FindlibParent:        jupyter
  BuildDepends:         jupyter, threads, base64, compiler-libs
  XMETARequires:        jupyter, threads, base64, compiler-libs
  Modules:              JupyterNotebook,
                        JupyterNotebookCommManager
  InternalModules:      JupyterNotebookRouter,
                        JupyterNotebookStdin,
                        JupyterNotebookUnsafe

Library "jupyter-archimedes"
  Path:                 lib/archimedes
  Build$:               flag(archimedes)
  Install$:             flag(archimedes)
  FindlibName:          archimedes
  FindlibParent:        jupyter
  BuildDepends:         jupyter.notebook, archimedes.cairo
  XMETARequires:        jupyter.notebook, archimedes.cairo
  Modules:              JupyterArchimedes

##
## Documentation
##

Document jupyter
  Title:                OCaml Jupyter Core Library
  Type:                 OCamlbuild (0.4)
  BuildTools+:          ocamldoc
  InstallDir:           $docdir/core
  XOCamlbuildPath:      lib/core
  XOCamlbuildLibraries: jupyter

Document "jupyter-notebook"
  Title:                OCaml Jupyter Notebook Library
  Type:                 OCamlbuild (0.4)
  BuildTools+:          ocamldoc
  InstallDir:           $docdir/notebook
  XOCamlbuildPath:      lib/notebook
  XOCamlbuildLibraries: jupyter.notebook

##
## Tests
##

Executable test_lib
  Path:                 test
  MainIs:               TestJupyter.ml
  Build$:               flag(tests)
  Install:              false
  BuildDepends:         jupyter.kernel, jupyter.notebook, str, ppx_deriving.show, oUnit
  CompiledObject:       byte

Test test_lib
  Run$:                 flag(tests)
  Command:              $test_lib -runner sequential
  WorkingDirectory:     test
